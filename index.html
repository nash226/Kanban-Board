<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kanban Board</title>
  <style>body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background-color: #f4f7f9;
  color: #333;
  margin: 0;
  padding: 20px;
}

.app-container {
  max-width: 1200px;
  margin: 0 auto;
}

.app-header {
  text-align: center;
  margin-bottom: 20px;
}

.kanban-board {
  display: flex;
  justify-content: space-between;
  gap: 20px;
}

.kanban-column {
  flex: 1;
  background-color: #e9ecef;
  border-radius: 5px;
  padding: 15px;
}

.column-title {
  font-weight: bold;
  margin-bottom: 15px;
  text-align: center;
}

.task-cards {
  min-height: 100px; /* To give empty columns some height */
}

.task-card {
  background-color: #fff;
  border-radius: 5px;
  padding: 10px;
  margin-bottom: 10px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  cursor: grab;
}

.add-task-container {
  margin-top: 20px;
  text-align: center;
}

#add-task-form input {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 300px;
}

#add-task-form button {
  padding: 10px 15px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.task-card {
    display: flex; /* Add this ​_/
    justify-content: space-between; /_​ Add this ​_/
    align-items: center; /_​ Add this */
    }

    
    .delete-btn {
      background: none;
      border: none;
      color: #cc0000;
      cursor: pointer;
      font-weight: bold;
    }
    .task-card.dragging {
      opacity: 0.5;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
</style>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <h1>My Kanban Board</h1>
    </header>
    <main id="kanban-board" class="kanban-board"></main>
    
    <div class="add-task-container">
      <form id="add-task-form">
        <input type="text" id="task-input" placeholder="Enter a new task..." required>
        <button type="submit">Add Task</button>
      </form>
    </div>
  </div>
  <script>

let tasks = []

function createTaskEle(task) {
  let div = document.createElement('div')
  div.classList.add('task-card')
  div.textContent = task.content
  div.dataset.taskId = task.id
  div.setAttribute('draggable', 'true')
  let button = document.createElement('button')
  button.textContent = 'X'
  button.classList.add('delete-btn')
  div.append(button)
  return div
}

function renderTasks() {
  let taskCards = document.querySelectorAll('.task-cards')
  taskCards.forEach(ele => {
    ele.innerHTML = ''
  })
  tasks.forEach(task => {
    let taskEle = createTaskEle(task)
    let taskContainer = [...taskCards].find(taskCard => taskCard.dataset.id === task.status)
    taskContainer.append(taskEle)
  })
}

function saveTasks() {
  let taskState = JSON.stringify(tasks)
  localStorage.setItem('kanban-tasks', taskState)
}

function loadTasks() {
  jsonString = localStorage.getItem('kanban-tasks')
  if (jsonString) {
    let taskData = JSON.parse(jsonString)
    tasks = taskData
  }
}

const columns = [
  { title: 'To Do', id: 'todo'},
  { title: 'In Progress', id: 'inprogress'},
  { title: 'Done', id: 'done'},
]

document.addEventListener('DOMContentLoaded', () => {
  
  let mainBoard = document.getElementById('kanban-board')
  let addTaskForm = document.getElementById('add-task-form')

  function columnCreator() {
    columns.forEach(element => {
      let div = document.createElement('div')
      div.classList.add('kanban-column')
      let h2 = document.createElement('h2')
      h2.classList.add('column-title')
      h2.textContent = element.title
      let divTaskCard = document.createElement('div')
      divTaskCard.classList.add('task-cards')
      divTaskCard.dataset.id = element.id
      div.append(h2, divTaskCard)
      mainBoard.appendChild(div)
    })
  }

  addTaskForm.addEventListener('submit', (e) => {
    e.preventDefault()
    let taskValue = document.getElementById('task-input').value
    if (taskValue) {
      let taskObject = {
        id: Date.now(),
        content: taskValue,
        status: 'todo'
      }
      tasks.push(taskObject)
      renderTasks()
      saveTasks()
      addTaskForm.reset()
    }
  })

  mainBoard.addEventListener('click', (e) => {
    if (e.target.classList.contains('delete-btn')) {
      let parent = e.target.closest('.task-card')
      let id = parent.dataset.taskId
      tasks = tasks.filter(taskObj => taskObj.id !== Number(id))
      renderTasks()
      saveTasks()
      console.log(parent)
    }
  })


  mainBoard.addEventListener('dragstart', (e) => {
    if (e.target.classList.contains('task-card')) {
      // e.target.classList.add('dragging');
      e.dataTransfer.setData('text/plain', e.target.dataset.taskId)
    }
  })

  mainBoard.addEventListener('dragover', (e) => {
    e.preventDefault()
  })

  mainBoard.addEventListener('drop', (e) => {
    e.preventDefault()
    let id = event.dataTransfer.getData('text/plain')
    let kanbanColumn = e.target.closest('.kanban-column')
    if (!kanbanColumn) return; 

    let columnTaskContainer = kanbanColumn.querySelector('.task-cards')
    let status = columnTaskContainer.dataset.id
    let currentTask = tasks.find(taskObj => taskObj.id === Number(id))
    currentTask.status = status
    renderTasks()
    saveTasks()
  })

   mainBoard.addEventListener('dragend', (e) => {
      if (e.target.classList.contains('task-card')) {
        e.target.classList.remove('dragging'); // Clean up the class
      }
    });


  //initialize empty board
  columnCreator()
  loadTasks()
  renderTasks()
})

  </script>
</body>
</html>